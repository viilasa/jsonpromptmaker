{"version":3,"sources":["../../server/index.ts"],"sourcesContent":["import express from 'express';\nimport cors from 'cors';\nimport * as dotenv from 'dotenv';\nimport { GoogleGenerativeAI } from '@google/generative-ai';\nimport OpenAI from 'openai';\nimport { fileURLToPath } from 'node:url';\nimport path, { dirname, join } from 'node:path';\nimport { existsSync, readdirSync, readFileSync } from 'fs';\nimport bodyParser from 'body-parser';\nimport type { Request, Response, NextFunction } from 'express';\n\n// Get directory name in a way that works with both ESM and CommonJS\nlet __filename: string, __dirname: string;\ntry {\n  // @ts-ignore - This works in ESM\n  __filename = fileURLToPath(import.meta.url);\n  __dirname = dirname(__filename);\n} catch (e) {\n  // Fallback for CommonJS\n  // @ts-ignore - This works in CommonJS\n  __filename = __filename || '';\n  // @ts-ignore - This works in CommonJS\n  __dirname = __dirname || '';\n}\n\n// Load environment variables from .env file\ndotenv.config();\n\nconst app = express();\nconst port = Number(process.env.PORT) || 3001;\n\n// Middleware\napp.use(cors());\napp.use(bodyParser.json());\n\n// Health check endpoint\napp.get('/health', (req, res) => {\n  res.status(200).json({\n    status: 'ok',\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime(),\n    memory: process.memoryUsage(),\n    env: process.env.NODE_ENV || 'development'\n  });\n});\n\n// Gemini API configuration\nconst GEMINI_API_KEY = process.env.GEMINI_API_KEY || 'AIzaSyB-t16TK4F8lpuCob0wsUwQAm03jrGUiyY';\nconst GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';\n\nif (!GEMINI_API_KEY) {\n  console.warn('Warning: GEMINI_API_KEY is not set in environment variables. Using default key.');\n}\n\n// Add this new endpoint for AI-powered input enhancement\napp.post('/api/enhance-prompt', async (req, res) => {\n  try {\n    const { prompt, input, fieldType } = req.body;\n\n    if (!input || typeof input !== 'string') {\n      return res.status(400).json({ error: 'Invalid input' });\n    }\n\n    // Use the provided prompt or create a default enhancement prompt\n    const enhancementPrompt = prompt || `You are a master AI prompt engineer specializing in creating highly detailed, vivid, and creative image generation prompts. Your expertise is in transforming simple concepts into rich, descriptive prompts that capture the essence and imagination of the original idea.\n\nINPUT: \"${input}\"\n\nTASK: Transform this simple concept into a highly detailed, vivid, and imaginative prompt suitable for AI image generation. Create a surreal, artistic, and visually stunning description that brings the concept to life with rich detail.\n\n1. ENHANCED VERSION: Create a detailed, vivid description that transforms the simple concept into something magical and visually compelling\n2. REASONING: Explain how you interpreted the concept and what creative elements you added\n3. CONFIDENCE: How confident you are in this enhancement (0-100%)\n4. SUGGESTIONS: 3 alternative creative interpretations\n\nCREATIVE FOCUS:\n- Transform simple concepts into surreal, artistic visions\n- Add rich sensory details (textures, colors, lighting)\n- Include imaginative elements that elevate the concept\n- Use descriptive language that paints vivid mental pictures\n- Add artistic style elements (hyper-realistic, fantasy, surreal)\n- Include environmental and atmospheric details\n- Use professional art and photography terminology\n\nEXAMPLE TRANSFORMATION:\nInput: \"a cat wearing a hat\"\nEnhanced: \"A majestic feline adorned with an elaborate Victorian top hat, its fur rendered in hyper-realistic detail with each individual hair catching the golden hour light, surrounded by floating feathers and magical sparkles, in the style of whimsical fantasy art, trending on ArtStation\"\n\nRESPONSE FORMAT (JSON):\n{\n  \"enhanced\": \"your highly detailed and creative enhanced version here\",\n  \"reasoning\": \"your explanation of the creative transformation here\",\n  \"confidence\": 95,\n  \"suggestions\": [\"alternative 1\", \"alternative 2\", \"alternative 3\"]\n}`;\n\n    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        contents: [\n          {\n            parts: [\n              {\n                text: enhancementPrompt\n              }\n            ]\n          }\n        ],\n        generationConfig: {\n          temperature: 0.7,\n          topP: 0.9,\n          maxOutputTokens: 1000,\n        },\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API request failed with status ${response.status}`);\n    }\n\n    const data = await response.json();\n    const enhancedText = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim();\n\n    if (!enhancedText) {\n      throw new Error('Failed to enhance input');\n    }\n\n    // Try to parse the JSON response from Gemini\n    let parsedResponse;\n    try {\n      parsedResponse = JSON.parse(enhancedText);\n    } catch (parseError) {\n      // If parsing fails, create a fallback response\n      parsedResponse = {\n        enhanced: input,\n        reasoning: \"Enhanced with AI assistance\",\n        confidence: 75,\n        suggestions: [\"Add more descriptive details\", \"Include lighting information\", \"Specify textures and materials\"]\n      };\n    }\n\n    res.json(parsedResponse);\n  } catch (error) {\n    console.error('Error enhancing prompt:', error);\n    res.status(500).json({\n      error: 'Failed to enhance prompt',\n      details: error instanceof Error ? error.message : 'Unknown error',\n      enhanced: req.body.input, // Return original input as fallback\n      reasoning: \"Using original input due to enhancement service error\",\n      confidence: 50,\n      suggestions: [\"Add more descriptive details\", \"Include lighting information\", \"Specify textures and materials\"]\n    });\n  }\n});\napp.post('/api/generate-image-prompt', async (req, res) => {\n  try {\n    const { config } = req.body;\n\n    if (!config || typeof config !== 'object') {\n      return res.status(400).json({ error: 'Invalid configuration' });\n    }\n\n    // Enhanced prompt template for professional image generation\n    const systemPrompt = `You are a professional AI prompt engineer specializing in creating highly detailed, cinematic, and visually stunning image generation prompts. Your task is to create a prompt that would generate professional-quality images similar to those created on Leonardo.AI.\n\nIMAGE GENERATION INSTRUCTIONS:\n1. Create a detailed, vivid, and visually rich description based on the following parameters:\n   - MAIN SUBJECT: ${config.subject || 'Not specified'}\n   - ART STYLE: ${config.style || 'Photorealistic'}\n   - LIGHTING: ${config.lighting || 'Dramatic cinematic lighting'}\n   - COMPOSITION: ${config.composition?.join(', ') || 'Professional composition'}\n   - QUALITY: ${config.quality || '8'}/10 (where 10 is maximum quality)\n   - ASPECT RATIO: ${config.aspectRatio || '1:1'}\n\n2. INCLUDE THESE ELEMENTS IN THE PROMPT:\n   - Detailed description of the main subject with specific details\n   - Vivid descriptions of textures, materials, and surfaces\n   - Specific lighting conditions and atmosphere\n   - Color palette and mood\n   - Camera angle and framing details\n   - Professional photography/cinematography terms\n   - Any relevant artistic influences or references\n\n3. FORMAT REQUIREMENTS:\n   - Use professional, descriptive language\n   - Structure the prompt with clear, comma-separated elements\n   - Include technical photography/cinematography terms\n   - Keep it concise but detailed (2-4 sentences)\n   - Focus on visual elements that would help an image generation model\n   - Use power words that emphasize quality and detail\n\n4. EXAMPLE STRUCTURE:\n   \"[Subject description], [detailed physical attributes], [action/pose], [clothing/detailing], [lighting conditions], [color scheme], [art style], [camera details], [mood/atmosphere], [professional photography terms], [quality descriptors]\"\n\nPROMPT TO GENERATE:`;\n\n    // Call Gemini API\n    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        contents: [\n          {\n            parts: [\n              {\n                text: systemPrompt\n              }\n            ]\n          }\n        ],\n        generationConfig: {\n          temperature: 0.8,\n          topP: 0.9,\n          topK: 40,\n          maxOutputTokens: 1024,\n        },\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API request failed with status ${response.status}`);\n    }\n\n    const data = await response.json();\n    let generatedPrompt = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim();\n\n    if (!generatedPrompt) {\n      throw new Error('Failed to generate prompt');\n    }\n\n    // Post-process the generated prompt\n    generatedPrompt = postProcessPrompt(generatedPrompt);\n\n    // Enhanced negative prompt\n    const enhancedNegativePrompt = [\n      'low quality', 'blurry', 'distorted', 'extra limbs', 'bad anatomy',\n      'poorly drawn', 'cloned face', 'disfigured', 'deformed', 'poor details',\n      'ugly', 'duplicate', 'morbid', 'mutilated', 'extra fingers',\n      'mutated hands', 'poorly drawn hands', 'mutation', 'deformed',\n      'bad proportions', 'extra limbs', 'extra legs', 'extra arms',\n      'disfigured', 'bad anatomy', 'gross proportions', 'malformed limbs',\n      'missing arms', 'missing legs', 'extra digits', 'fused digits',\n      'too many fingers', 'long neck', 'text', 'watermark', 'signature', 'logo'\n    ].join(', ');\n\n    res.json({\n      prompt: generatedPrompt,\n      negative_prompt: config.negativePrompt || enhancedNegativePrompt,\n      width: config.width || 1024,\n      height: config.height || 1024,\n      num_inference_steps: config.steps || 30,\n      guidance_scale: config.cfgScale || 7.5,\n      model: config.model || 'Stable Diffusion XL',\n      sampler: config.sampler || 'k_euler_ancestral',\n      seed: config.seed,\n      high_noise_frac: 0.8,\n      preset: 'photography',\n      prompt_magic: true,\n      prompt_magic_version: 'v3',\n      prompt_magic_strength: 0.8\n    });\n\n  } catch (error: unknown) {\n    console.error('Error generating image prompt:', error);\n    const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred';\n    res.status(500).json({\n      error: 'Failed to generate prompt',\n      details: errorMessage\n    });\n  }\n});\n\n// Helper function to clean and enhance the generated prompt\nfunction postProcessPrompt(prompt: string): string {\n  // Remove any line breaks and extra spaces\n  prompt = prompt.replace(/\\n/g, ' ').replace(/\\s+/g, ' ').trim();\n\n  // Remove any quotes if present\n  prompt = prompt.replace(/^[\"']|[\"']$/g, '');\n\n  // Ensure the prompt ends with a period\n  if (!/[.!?]$/.test(prompt)) {\n    prompt = prompt + '.';\n  }\n\n  // Add some quality boosters if not already present\n  const qualityBoosters = [\n    'highly detailed', 'intricate details', 'sharp focus', '8k', '4k',\n    'unreal engine 5', 'octane render', 'cinematic lighting', 'professional photography',\n    'artstation', 'concept art', 'digital art', 'trending on artstation'\n  ];\n\n  // Add quality boosters if they're not already in the prompt\n  qualityBoosters.forEach(booster => {\n    if (!prompt.toLowerCase().includes(booster.toLowerCase())) {\n      prompt += `, ${booster}`;\n    }\n  });\n\n  return prompt;\n}\n\n// API routes\napp.post('/api/generate-json', async (req, res) => {\n  try {\n    const { prompt } = req.body;\n\n    if (!prompt) {\n      return res.status(400).json({ error: 'Prompt is required' });\n    }\n\n    // Enhanced prompt for Gemini\n    const systemPrompt = `You are an AI assistant that enhances and structures prompts into comprehensive, detailed JSON outputs.\n    \n    TASK:\n    1. ENHANCE the following prompt by adding more detail, context, and specificity\n    2. STRUCTURE the enhanced output as a well-formatted JSON object\n    3. INCLUDE all relevant details from the original prompt\n    \n    REQUIREMENTS:\n    - The output MUST be valid JSON\n    - Include all key elements from the original prompt\n    - Add relevant context and details\n    - Use proper JSON formatting with escaped characters\n    \n    ORIGINAL PROMPT: \"${prompt}\"\n    \n    ENHANCED OUTPUT (as JSON):`;\n\n    // Call Gemini API\n    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        contents: [\n          {\n            parts: [\n              {\n                text: systemPrompt\n              }\n            ]\n          }\n        ],\n        generationConfig: {\n          temperature: 0.7,\n          topP: 0.8,\n          topK: 40,\n          maxOutputTokens: 1024,\n          responseMimeType: 'application/json',\n        },\n      }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.text();\n      console.error('Gemini API error:', errorData);\n      throw new Error(`Gemini API request failed with status ${response.status}`);\n    }\n\n    const data = await response.json();\n    \n    // Extract the JSON content from the response\n    const content = data.candidates?.[0]?.content?.parts?.[0]?.text;\n    if (!content) {\n      console.error('Unexpected Gemini API response:', data);\n      throw new Error('No content received from the AI model');\n    }\n\n    // Parse the JSON content\n    let result;\n    try {\n      // Try to extract JSON from markdown code blocks if present\n      const jsonMatch = content.match(/```(?:json)?\\n([\\s\\S]*?)\\n```/);\n      result = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(content);\n    } catch (error) {\n      console.error('Error parsing JSON response:', error);\n      console.error('Response content:', content);\n      throw new Error('Failed to parse AI response');\n    }\n    \n    // Add timestamp if not present\n    if (!result.timestamp) {\n      result.timestamp = new Date().toISOString();\n    }\n\n    res.status(200).json(result);\n  } catch (error) {\n    console.error('Error generating JSON:', error);\n    res.status(500).json({ error: 'Failed to generate JSON' });\n  }\n});\n\n// Serve static files from the Vite build\nconst clientDistPath = join(process.cwd(), 'dist/client');\nconst indexPath = join(clientDistPath, 'index.html');\n\n// Log the paths for debugging\nconsole.log('Current working directory:', process.cwd());\nconsole.log('Client dist path:', clientDistPath);\nconsole.log('Index path:', indexPath);\nconsole.log('Directory exists:', existsSync(clientDistPath));\nconsole.log('Index.html exists:', existsSync(indexPath));\n\n// Log directory contents for debugging\nif (existsSync(clientDistPath)) {\n  console.log('Client dist directory contents:', readdirSync(clientDistPath));\n  if (existsSync(join(clientDistPath, 'assets'))) {\n    console.log('Assets directory contents:', readdirSync(join(clientDistPath, 'assets')));\n  }\n}\n\n// Serve static files with proper caching headers\napp.use(express.static(clientDistPath, {\n  etag: true,\n  lastModified: true,\n  maxAge: '1y',\n  setHeaders: (res, path) => {\n    // Cache static assets for 1 year\n    if (path.endsWith('.js') || path.endsWith('.css') || path.endsWith('.png') || path.endsWith('.jpg') || path.endsWith('.svg')) {\n      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');\n    } else {\n      // No cache for HTML files\n      res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n    }\n  }\n}));\n\n// Log the contents of index.html for debugging\nif (existsSync(indexPath)) {\n  try {\n    const indexContent = readFileSync(indexPath, 'utf-8');\n    console.log('Index.html content (first 500 chars):', indexContent.substring(0, 500));\n  } catch (err) {\n    console.error('Error reading index.html:', err);\n  }\n}\n\n// Handle API routes\napp.use('/api', (req, res, next) => {\n  next();\n});\n\n// Handle client-side routing - must be the last route\napp.get(/^(?!\\/api).*/, (req, res, next) => {\n  // Check if the request is for a file with an extension\n  const hasExtension = path.extname(req.path).length > 1;\n  \n  // If it's a file request with an extension, try to serve it\n  if (hasExtension) {\n    // Use path.posix for consistent path handling across platforms\n    const normalizedPath = req.path.split(path.sep).join(path.posix.sep);\n    const filePath = path.join(clientDistPath, normalizedPath);\n    \n    // Check if the file exists\n    if (existsSync(filePath)) {\n      return res.sendFile(filePath, (err: NodeJS.ErrnoException | null) => {\n        if (err) {\n          console.error(`Error serving file ${req.path}:`, err);\n          // If there's an error serving the file, fall back to index.html\n          serveIndexHtml(res);\n        }\n      });\n    }\n  }\n  \n  // For all other requests, serve index.html\n  serveIndexHtml(res);\n});\n\n// Helper function to serve index.html\nfunction serveIndexHtml(res: Response) {\n  console.log('Serving index.html for SPA routing');\n  \n  // Check if index.html exists\n  if (!existsSync(indexPath)) {\n    console.error('Error: index.html not found at', indexPath);\n    return res.status(500).send('Application not built properly');\n  }\n  \n  // Set content type explicitly\n  res.setHeader('Content-Type', 'text/html');\n  \n  // Send the file\n  res.sendFile(indexPath, (err: NodeJS.ErrnoException | null) => {\n    if (err) {\n      console.error('Error serving index.html:', err);\n      if (!res.headersSent) {\n        res.status(500).send('Error loading the application');\n      }\n    }\n  });\n}\n\n// Error handling middleware - must be after all other routes\napp.use((err: Error, req: Request, res: Response, next: NextFunction) => {\n  console.error('Unhandled error:', {\n    message: err.message,\n    stack: err.stack,\n    path: req.path,\n    method: req.method,\n    headers: req.headers\n  });\n  \n  res.status(500).json({\n    error: 'Internal Server Error',\n    message: process.env.NODE_ENV === 'production' \n      ? 'An unexpected error occurred' \n      : err.message,\n    ...(process.env.NODE_ENV === 'development' ? { \n      stack: err.stack,\n      path: req.path,\n      method: req.method\n    } : {})\n  });\n});\n\n// Handle 404 - Must be after all other routes but before error handling\napp.use((req, res, next) => {\n  console.log(`404 - ${req.method} ${req.path}`);\n  \n  // If it's an API request, return JSON\n  if (req.path.startsWith('/api/')) {\n    return res.status(404).json({\n      error: 'Not Found',\n      message: `The requested resource ${req.path} was not found`\n    });\n  }\n  \n  // For all other routes, serve the SPA's index.html for client-side routing\n  serveIndexHtml(res);\n});\n\n// Start the server with error handling\nconst host = '0.0.0.0';\nconst server = app.listen(port, host, () => {\n  console.log(`\\n=== Server Started ===`);\n  console.log(`Server is running on port ${port}`);\n  console.log(`Environment: ${process.env.NODE_ENV || 'development'}`);\n  console.log(`Node.js version: ${process.version}`);\n  console.log(`Platform: ${process.platform} ${process.arch}`);\n  console.log(`Process ID: ${process.pid}`);\n  console.log(`Serving static files from: ${clientDistPath}`);\n  console.log(`Health check: http://localhost:${port}/health`);\n  console.log('Press Ctrl+C to stop the server\\n');\n  \n  // Log memory usage\n  const used = process.memoryUsage();\n  for (const [key, value] of Object.entries(used)) {\n    console.log(`Memory: ${key} ${Math.round(value / 1024 / 1024 * 100) / 100} MB`);\n  }\n});\n\n// Handle server errors\nexport const closeServer = () => {\n  return new Promise<void>((resolve, reject) => {\n    server.close((err) => {\n      if (err) {\n        console.error('Error closing server:', err);\n        reject(err);\n      } else {\n        console.log('Server closed');\n        resolve();\n      }\n    });\n  });\n};\n\n// Handle process termination\nprocess.on('SIGTERM', () => {\n  console.log('SIGTERM received. Shutting down gracefully...');\n  closeServer().then(() => process.exit(0));\n});\n\nprocess.on('SIGINT', () => {\n  console.log('SIGINT received. Shutting down gracefully...');\n  closeServer().then(() => process.exit(0));\n});\n\n// Handle uncaught exceptions and unhandled rejections\nprocess.on('uncaughtException', (error) => {\n  console.error('Uncaught Exception:', error);\n  closeServer().then(() => process.exit(1));\n});\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason);\n  closeServer().then(() => process.exit(1));\n});\n\n// Handle server errors\nserver.on('error', (error: NodeJS.ErrnoException) => {\n  if (error.syscall !== 'listen') {\n    throw error;\n  }\n\n  const bind = typeof port === 'string' ? 'Pipe ' + port : 'Port ' + port;\n\n  // Handle specific listen errors with friendly messages\n  switch (error.code) {\n    case 'EACCES':\n      console.error(bind + ' requires elevated privileges');\n      process.exit(1);\n      break;\n    case 'EADDRINUSE':\n      console.error(bind + ' is already in use');\n      process.exit(1);\n      break;\n    default:\n      throw error;\n  }\n});\n\nexport default app;\n"],"mappings":"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","names":["express","cors","dotenv","fileURLToPath","path","dirname","join","existsSync","readdirSync","readFileSync","bodyParser","__filename","__dirname","app","port","req","res","GEMINI_API_KEY","GEMINI_API_URL","prompt","input","fieldType","enhancementPrompt","response","enhancedText","parsedResponse","error","config","systemPrompt","generatedPrompt","postProcessPrompt","enhancedNegativePrompt","errorMessage","booster","errorData","data","content","result","jsonMatch","clientDistPath","indexPath","indexContent","err","next","normalizedPath","filePath","serveIndexHtml","host","server","used","key","value","closeServer","resolve","reject","reason","promise","bind","index_default"]}